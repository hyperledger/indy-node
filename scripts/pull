#   Copyright 2017 Sovrin Foundation
#
#   Licensed under the Apache License, Version 2.0 (the "License");
#   you may not use this file except in compliance with the License.
#   You may obtain a copy of the License at
#
#       http://www.apache.org/licenses/LICENSE-2.0
#
#   Unless required by applicable law or agreed to in writing, software
#   distributed under the License is distributed on an "AS IS" BASIS,
#   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#   See the License for the specific language governing permissions and
#   limitations under the License.
#

#! /usr/bin/env python3

import os

from git import Repo, InvalidGitRepositoryError


def getDirInPath(dirName):
    cwd = os.getcwd()
    while True:
        parent, cur = os.path.split(cwd)
        if cur == dirName:
            return cwd
        if parent == cwd:
            raise RuntimeError("no {} dir in path".format(dirName))
        cwd = parent


def thisRepo():
    cwd = os.getcwd()
    while True:
        try:
            return Repo(cwd)
        except InvalidGitRepositoryError:
            precwd = cwd
            cwd = os.path.dirname(cwd)
            if precwd == cwd:
                raise RuntimeError("no git repo in path")


def main():
    repo = thisRepo()
    print('repo: {}'.format(repo))
    remote = repo.remotes['origin']
    remote
    edir = getDirInPath('indy-node')
    print('indy-node directory: {}'.format(edir))


if __name__ == '__main__':
    main()

# g = git.cmd.Git(git_dir)
# g.pull()

# GACTION=pull
#
# pushd ../indy-priv
# pwd
# git $GACTION
#
# cd ../plenum-priv
# pwd
# git $GACTION
#
# cd ../anoncreds-priv/
# pwd
# git $GACTION
#
# popd
